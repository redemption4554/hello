<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ClÃ©mence - Ã‰ternitÃ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@200;400;900&display=swap');

        :root {
            --gold: #d4af37;
            --red: #ff0033;
        }

        /* EmpÃªche les rebonds et le scroll sur mobile */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: #000; height: 100vh; overflow: hidden; 
            font-family: 'Montserrat', sans-serif; position: fixed; width: 100%;
        }

        /* Ã‰cran de dÃ©marrage */
        #gate {
            position: fixed; inset: 0; background: #000; z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .btn-luxe {
            background: none; border: 1px solid var(--gold); color: var(--gold);
            padding: 15px 30px; font-family: 'Cinzel', serif; letter-spacing: 4px;
            text-transform: uppercase; cursor: pointer; font-size: 0.8rem;
        }

        canvas { position: absolute; inset: 0; z-index: 1; pointer-events: none; }

        /* Textes du haut (Souvenirs) */
        #ui-top {
            position: absolute; top: 12%; left: 0; width: 100%;
            text-align: center; z-index: 5; pointer-events: none;
            opacity: 0; transition: 1s;
        }
        .message-box {
            font-family: 'Cinzel', serif; color: var(--gold);
            font-size: 0.75rem; letter-spacing: 2px;
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
            padding: 0 30px;
        }

        /* Message d'explosion */
        #transition-msg {
            position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; text-align: center; z-index: 20; color: white;
            font-family: 'Cinzel', serif; font-size: 0.95rem; letter-spacing: 2px;
            opacity: 0; transition: 1.5s; line-height: 1.6;
            text-shadow: 0 0 15px var(--gold);
        }

        /* Zone de clic centrale */
        .interaction-zone {
            position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%);
            width: 250px; height: 250px;
            display: flex; justify-content: center; align-items: center;
            z-index: 10;
        }
        .main-heart-btn {
            font-family: 'Cinzel', serif; color: #fff; font-size: 1.6rem;
            letter-spacing: 4px; text-shadow: 0 0 20px var(--red);
            transition: 0.2s; pointer-events: none;
        }

        /* Cadenas (Secret) - AjustÃ© pour le pouce en bas */
        #secret-btn {
            position: absolute; bottom: 12%; left: 50%; transform: translateX(-50%);
            width: 55px; height: 55px; border-radius: 50%;
            border: 1px solid rgba(212, 175, 55, 0.4);
            background: rgba(0,0,0,0.6); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            color: var(--gold); font-size: 1.3rem;
        }
        #hold-fill {
            position: absolute; inset: -2px; border-radius: 50%;
            border: 2px solid var(--gold); border-top-color: transparent;
            opacity: 0;
        }

        /* FenÃªtre de la Lettre */
        #hiddenLetter {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98);
            z-index: 3000; display: none; justify-content: center; align-items: center;
            padding: 30px;
        }
        .letter-content {
            border: 1px solid var(--gold); padding: 35px 25px; text-align: center;
            color: #fff; font-family: 'Cinzel', serif; line-height: 1.8;
            background: #050505; font-size: 0.9rem; max-width: 400px;
        }

        /* Flash explosion */
        #flash {
            position: fixed; inset: 0; background: white; z-index: 1500;
            opacity: 0; pointer-events: none;
        }
    </style>
</head>
<body>

    <audio id="music" loop>
        <source src="https://www.chosic.com/wp-content/uploads/2021/07/Rainy-Day-Implicit.mp3" type="audio/mpeg">
    </audio>

    <div id="flash"></div>

    <div id="gate">
        <h2 style="color:var(--gold); font-family:'Cinzel'; margin-bottom:20px; letter-spacing:5px; font-size:0.9rem;">CLÃ‰MENCE</h2>
        <button class="btn-luxe" onclick="reveal()">Entrer dans mon cÅ“ur</button>
    </div>

    <div id="ui-top">
        <div class="message-box" id="m-text">BIENVENUE DANS MON CÅ’UR...</div>
    </div>

    <div id="transition-msg">CHAQUE POINT DE CE CÅ’UR CORRESPOND Ã€ MON AMOUR POUR TOI</div>

    <div id="hiddenLetter" onclick="this.style.display='none'">
        <div class="letter-content">
            <h3 style="color:var(--gold); margin-bottom:15px;">MA REINE</h3>
            <p>Tu es mon Ã©ternitÃ©, mon plus beau voyage stellaire.<br><br>Je t'aime infiniment.</p>
            <p style="margin-top:20px; font-size:0.7rem; color:var(--gold);">TOUCHE POUR FERMER</p>
        </div>
    </div>

    <div class="interaction-zone" onclick="triggerAction()">
        <h2 class="main-heart-btn" id="btn-label">JE T'AIME</h2>
    </div>

    <canvas id="world"></canvas>

    <div id="secret-btn" ontouchstart="startHold(event)" ontouchend="endHold()">
        <div id="hold-fill"></div>
        <span>ðŸ”’</span>
    </div>

    <script>
        const canvas = document.getElementById('world');
        const ctx = canvas.getContext('2d');
        const audio = document.getElementById('music');
        
        let width, height, dpr;
        let particles = [];
        let isRevealed = false;
        let rotation = 0;
        let holdTimer;
        let clickCount = 0;
        let state = "NORMAL";

        const SOUVENIRS = [
            "TON SOURIRE...", "NOS NUITS...", "TON REGARD...",
            "CETTE MAGIE...", "NOTRE AMOUR...", "MON Ã‰TERNITÃ‰...", "REGARDE BIEN..."
        ];

        function init() {
            dpr = Math.min(window.devicePixelRatio || 1, 2);
            width = window.innerWidth; height = window.innerHeight;
            canvas.width = width * dpr; canvas.height = height * dpr;
            ctx.scale(dpr, dpr);

            // TAILLE DU COEUR OPTIMISÃ‰E POUR TÃ‰LÃ‰PHONE
            // 0.032 assure que mÃªme sur les petits Ã©crans, on voit tout le coeur
            const heartScale = Math.min(width, height) * 0.032; 
            
            particles = [];
            for(let i=0; i<3500; i++) {
                let t = Math.random() * Math.PI * 2;
                let r = Math.sqrt(Math.random()) * heartScale;
                particles.push({
                    baseX: 16 * Math.pow(Math.sin(t), 3) * r,
                    baseY: -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * r,
                    baseZ: (Math.random()-0.5) * 150,
                    x: 0, y: 0, z: 0, vx: 0, vy: 0, vz: 0,
                    size: Math.random() * 1.2 + 0.3,
                    color: Math.random() > 0.15 ? "#ff0033" : "#d4af37"
                });
            }
            particles.forEach(p => { p.x = p.baseX; p.y = p.baseY; p.z = p.baseZ; });
        }

        function reveal() {
            audio.play();
            document.getElementById('gate').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('gate').style.display = 'none';
                document.getElementById('ui-top').style.opacity = '1';
                isRevealed = true;
            }, 800);
        }

        function triggerAction() {
            if(!isRevealed || state !== "NORMAL") return;
            const txt = document.getElementById('m-text');
            txt.style.opacity = 0;
            setTimeout(() => {
                txt.innerText = SOUVENIRS[clickCount % SOUVENIRS.length];
                txt.style.opacity = 1;
                clickCount++;
                if(clickCount === 8) startSupernova();
            }, 250);
        }

        function startSupernova() {
            state = "EXPLODING";
            document.getElementById('btn-label').style.opacity = '0';
            document.getElementById('ui-top').style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('flash').style.opacity = '1';
                setTimeout(() => {
                    document.getElementById('flash').style.opacity = '0';
                    particles.forEach(p => {
                        let f = Math.random() * 40 + 20;
                        p.vx = (Math.random() - 0.5) * f;
                        p.vy = (Math.random() - 0.5) * f;
                        p.vz = (Math.random() - 0.5) * f;
                    });
                    setTimeout(() => {
                        state = "MESSAGE";
                        document.getElementById('transition-msg').style.opacity = '1';
                        setTimeout(() => {
                            document.getElementById('transition-msg').style.opacity = '0';
                            state = "REFORMING";
                            setTimeout(() => {
                                state = "NORMAL";
                                clickCount = 0;
                                document.getElementById('btn-label').style.opacity = '1';
                                document.getElementById('ui-top').style.opacity = '1';
                                document.getElementById('m-text').innerText = "CLÃ‰MENCE, MON TOUT...";
                            }, 3000);
                        }, 4000);
                    }, 2000);
                }, 100);
            }, 1000);
        }

        function startHold(e) {
            e.preventDefault();
            const fill = document.getElementById('hold-fill');
            fill.style.opacity = "1";
            fill.animate([{transform: 'rotate(0deg)'}, {transform: 'rotate(360deg)'}], {duration: 1000, iterations: Infinity});
            holdTimer = setTimeout(() => {
                document.getElementById('hiddenLetter').style.display = 'flex';
                endHold();
            }, 1500);
        }
        function endHold() { clearTimeout(holdTimer); document.getElementById('hold-fill').style.opacity = "0"; }

        function animate() {
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(0,0,width,height);

            if(isRevealed) {
                rotation += 0.013;
                let pulse = 1 + Math.sin(Date.now() * 0.003) * 0.1;

                particles.forEach((p, i) => {
                    if(state === "EXPLODING") {
                        p.x += p.vx; p.y += p.vy; p.z += p.vz;
                        p.vx *= 0.96; p.vy *= 0.96; p.vz *= 0.96;
                    } else if(state === "REFORMING") {
                        p.x += (p.baseX - p.x) * 0.08;
                        p.y += (p.baseY - p.y) * 0.08;
                        p.z += (p.baseZ - p.z) * 0.08;
                    }

                    let cosR = Math.cos(rotation), sinR = Math.sin(rotation);
                    let rx = p.x * cosR - p.z * sinR;
                    let rz = p.x * sinR + p.z * cosR;
                    let s = 450 / (450 + rz + 180);
                    let px = rx * s * (state === "NORMAL" ? pulse : 1) + width / 2;
                    let py = p.y * s * (state === "NORMAL" ? pulse : 1) + height * 0.48; // CentrÃ© parfaitement

                    ctx.globalAlpha = s;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(px, py, p.size * s, p.size * s);
                });
            }
            requestAnimationFrame(animate);
        }

        init(); animate();
        window.addEventListener('resize', init);
    </script>
</body>
</html>
